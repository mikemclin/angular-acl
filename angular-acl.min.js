"use strict";var NG_HIDE_CLASS="ng-hide";angular.module("mm.acl",[]),angular.module("mm.acl").provider("AclService",["$windowProvider",function(a){function b(){var a;switch(e.storage){case"sessionStorage":a=m("sessionStorage");break;case"localStorage":a=m("localStorage");break;default:a=null}return!!a&&(angular.extend(f,a),!0)}Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(var b=this.length;b--;)if(this[b]===a)return b;return-1});var c=a.$get(),d=function(a,b){var c;try{c=a[b]}catch(a){c=!1}if(c){var d="__"+Math.round(1e7*Math.random());try{a[b].setItem(d,d),a[b].removeItem(d,d)}catch(a){c=!1}}return c},e={storage:"sessionStorage",storageKey:"AclService"},f={roles:[],abilities:{}},g=function(a){return"object"==typeof f.abilities[a]},h=function(a){return g(a)?f.abilities[a]:[]},i=function(){switch(e.storage){case"sessionStorage":k("sessionStorage");break;case"localStorage":k("localStorage");break;default:return}},j=function(){switch(e.storage){case"sessionStorage":l("sessionStorage");break;case"localStorage":l("localStorage");break;default:return}},k=function(a){d(c,e.storage)&&window[a].setItem(e.storageKey,JSON.stringify(f))},l=function(a){d(c,e.storage)&&window[a].removeItem(e.storageKey)},m=function(a){if(!d(c,e.storage))return!1;var b=window[a].getItem(e.storageKey);return!!b&&JSON.parse(b)},n={};return n.resume=b,n.flushStorage=function(){d(c,e.storage)&&j()},n.attachRole=function(a){-1===f.roles.indexOf(a)&&(f.roles.push(a),d(c,e.storage)&&i())},n.detachRole=function(a){var b=f.roles.indexOf(a);b>-1&&(f.roles.splice(b,1),d(c,e.storage)&&i())},n.flushRoles=function(){f.roles=[],d(c,e.storage)&&i()},n.hasRole=function(a){for(var b=angular.isArray(a)?a:[a],c=b.length;c--;)if(-1===f.roles.indexOf(b[c]))return!1;return!!b.length},n.hasAnyRole=function(a){for(var b=a.length;b--;)if(n.hasRole(a[b]))return!0;return!1},n.getRoles=function(){return f.roles},n.setAbilities=function(a){f.abilities=a,d(c,e.storage)&&i()},n.addAbility=function(a,b){f.abilities[a]||(f.abilities[a]=[]),f.abilities[a].push(b),d(c,e.storage)&&i()},n.can=function(a){for(var b,c,d=f.roles.length;d--;)if(b=f.roles[d],c=h(b),c.indexOf(a)>-1)return!0;return!1},n.canAny=function(a){for(var b,c,d=f.roles.length,e=a.length;d--;)for(b=f.roles[d],c=h(b);e--;)if(c.indexOf(a[e])>-1)return!0;return!1},{config:function(a){angular.extend(e,a)},resume:b,$get:function(){return n}}}]).directive("aclShow",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.aclShow,function(b){var d,e;if(!b)return void c.addClass(NG_HIDE_CLASS);d=b.split(","),e=a.canAny(d),e?c.removeClass(NG_HIDE_CLASS):c.addClass(NG_HIDE_CLASS)})}}});